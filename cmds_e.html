<!DOCTYPE html>
<html>
<head>
<title>Linux quick reference (e2fsck, e2label, egrep, env, expand)</title>
<meta name="description" content="linux quick reference, e2fsck, e2label, egrep, env, expand" />
<meta name="charset" content="UTF-8" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="-1">
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" type="text/css" href="css/main.css" />
<script src="js/jquery.js"></script>
<script src="js/z002.js"></script>
</head><body>

<div id="main">

<div id="topmenu">
<p class="menu">
<a href="#e2fsck">e2fsck</a>&nbsp;|
<a href="#e2label">e2label</a>&nbsp;|
<a href="#env">env</a>&nbsp;|
<a href="#ethtool">ethtool</a>&nbsp;|
<a href="#expand">expand</a></p>
</div>

<p class="cmdname"><a name="e2fsck">e2fsck</a></p>
<p>
checks <samp>ext2</samp>/<samp>ext3</samp>/<samp>ext4</samp> filesystems (fs
must be unmounted). In case of <samp>ext3/4</samp>, it first applies journal
and then usually exits, unless superblock requires further checking.</p>

<p class="cmdc">e2fsck /dev/sda4</p>
<p class="desc">check filesystem on the device <samp>/dev/sda4</samp>;</p>

<p class="cmdc">e2fsck -f /dev/sda4</p>
<p class="desc">force filesystem checking even if journal seems OK;</p>

<p class="cmdc">e2fsck -pv /dev/hda2</p>
<p class="desc">check fs on <samp>/dev/hda2</samp> and automatically
correct errors;</p>

<p class="cmdc">e2fsck -pDf /dev/sda7</p>
<p class="desc">force check on <samp>/dev/sda7</samp>, auto correct errors,
optimize dirs;</p>

<p class="cmdc">e2fsck -b 8193 /dev/sda4</p>
<p class="desc">check fs on <samp>/dev/sda4</samp> and correct errors using
an alternative superblock (<samp>#8193</samp>);</p>

<p class="fmt"><code>e2fsck&nbsp;</code>[<kbd>options</kbd>]<kbd>&nbsp;device</kbd></p>
<p>
To check <samp>/</samp> (root fs), <samp>/var</samp> and other busy
filesystems, you should restart OS using
<code><a href="cmds_s.html#shutdown">shutdown</a></code> with <code>-F</code>
option, e.g.:</p>

<p class="cmd">shutdown -r -F now</p>


<h5>Some options</h5>

<table class="options">
<tr>
<td class="opt_name"><code>-V</code></td>
<td class="opt_desc">version;</td></tr>
<tr>
<td class="opt_name"><code>-v</code></td>
<td class="opt_desc">verbose;</td></tr>
<tr>
<td class="opt_name"><code>-a</code></td>
<td class="opt_desc">same as <code>-p</code> (provided for backward
compatibility);</td></tr>
<tr>
<td class="opt_name"><code>-b</code> <kbd>n</kbd></td>
<td class="opt_desc">
use an alternative superblock specified by <kbd>n</kbd>; normally used when
the primary superblock is corrupted; most fs have backup superblocks located
at <samp>8193</samp>, <samp>16384</samp>, <samp>32768</samp>,
<samp>98304</samp>, <samp>163840</samp>, <samp>229376</samp>,
<samp>294912</samp>, etc; <i>location</i> depends on options used for fs
creation and block size: it starts from <samp>8193</samp> for fs with
<samp>1k</samp> block size, from <samp>16384</samp> for fs with <samp>2k</samp>
block size, from <samp>32768</samp> for fs with <samp>4k</samp> block size;
if an alternative superblock is specified and the fs is not opened read-only,
<code>~</code> will make sure that primary superblock is updated appropriately
upon completion of the fs check;</td></tr>
<tr>
<td class="opt_name"><code>-c</code></td>
<td class="opt_desc">invoke
<code><a href="cmds_b.html#badblocks">badblocks</a></code>;
if specified twice, then bad block scan will be done using a non-destructive
read-write test (slow);</td></tr>
<tr>
<td class="opt_name"><code>-D</code></td>
<td class="opt_desc">try to optimize all dirs either by reindexing (if fs
supports dir indexing) or by sorting and compressing;</td></tr>
<tr>
<td class="opt_name"><code>-f</code></td>
<td class="opt_desc">force checking even if fs seems to be clean;</td></tr>
<tr>
<td class="opt_name"><code>-F</code></td>
<td class="opt_desc">flush the filesystem device's buffer caches before beginning;</td></tr>
<tr>
<td class="opt_name"><code>-k</code></td>
<td class="opt_desc">in combination with <code>-c</code>, add new bad blocks
found by <code>badblocks</code> to the list of existing bad blocks;</td></tr>
</table>

<p class="fmtc"><code>-l</code> <kbd>file</kbd></p>
<p class="desc">add the block numbers listed in <kbd>file</kbd> to the list
of bad blocks; the format of this file is the same as generated by the
<code>badblocks</code>;</p>

<p class="fmtc"><code>-L</code> <kbd>file</kbd></p>
<p class="desc">clear existing bad blocks list and set new from <kbd>file</kbd>;</p>

<table class="options">
<tr>
<td class="opt_name"><code>-n</code></td>
<td class="opt_desc">open fs read-only, and assume "no" to all questions;</td></tr>
<tr>
<td class="opt_name"><code>-p</code></td>
<td class="opt_desc">automatically repair (preen) fs without any questions;</td></tr>
<tr>
<td class="opt_name"><code>-t</code></td>
<td class="opt_desc">print timing statistics; if specified twice, additional statistics are printed on pass by pass basis;</td></tr>
<tr>
<td class="opt_name"><code>-y</code></td>
<td class="opt_desc">assume "yes" to all questions;</td></tr>
</table>
<p>
The exit code is the sum of the following conditions:</p>
<table class="exit">
<tr>
<td class="exit_code">0</td><td class="code_desc">No errors</td></tr>
<tr>
<td class="exit_code">1</td><td class="code_desc">Filesystem errors corrected</td></tr>
<tr>
<td class="exit_code">2</td><td class="code_desc">Filesystem errors corrected, system should be rebooted</td></tr>
<tr>
<td class="exit_code">4</td><td class="code_desc">Filesystem errors left uncorrected</td></tr>
<tr>
<td class="exit_code">8</td><td class="code_desc">Operational error</td></tr>
<tr>
<td class="exit_code">16</td><td class="code_desc">Usage or syntax error</td></tr>
<tr>
<td class="exit_code">32</td><td class="code_desc">Canceled by user request</td></tr>
<tr>
<td class="exit_code">128</td><td class="code_desc">Shared library error</td></tr>
</table>



<p class="cmdname"><a name="e2label">e2label</a></p>
<p>
displays or changes <samp>ext2</samp>/<samp>ext3</samp>/<samp>ext4</samp>
filesystem label.</p>
<p class="fmt"><code>e2label&nbsp;</code><kbd>device&nbsp;</kbd>[<kbd>new_label</kbd>]</p>
<p>
If <kbd>new_label</kbd> is not specified, the current label is displayed.
Otherwise, <code>~</code> will set filesystem label to <kbd>new_label</kbd>.
If new label is longer than 16 characters, it will be truncated.</p>

<p class="cmdc">e2label /dev/sda5</p>
<p class="desc">show the label of the filesystem on <samp>/dev/sda5</samp>;</p>

<p class="cmdc">e2label /dev/sda7 home</p>
<p class="desc">set new label <samp>home</samp> for the filesystem on
<samp>/dev/sda7</samp>;</p>
<p>
If <code>~</code> outputs some error message, e.g.</p>

<p class="fmt"><samp>Couldn't find valid filesystem superblock.</samp></p>
<p>
it does not always mean that filesystem is bad, damaged, etc. Maybe
you just need the superuser privilege:</p>

<p class="cmd">sudo e2label /dev/sdf3</p>
<p>
You can also set/change label with
<code><a href="cmds_t.html#tune2fs">tune2fs</a></code>
(see <code>-L</code> option).</p>



<p class="cmdname"><a name="env">env</a></p>
<p>
sets each <kbd>name</kbd> to <kbd>value</kbd> in the environment and runs <kbd>cmd</kbd>. If <kbd>cmd</kbd> is missing,
<code>~</code> outputs the resulting env. The use of <code>-</code> has the same effect as the use of <code>-i</code> option.</p>

<p class="fmt"><code>env&nbsp;</code>[<kbd>options</kbd>] [<code>-</code>][<kbd>name</kbd><code>=</code><kbd>value</kbd>]<kbd>&nbsp;...&nbsp;</kbd>[<kbd>cmd&nbsp;</kbd>[<kbd>arg</kbd>]<kbd>&nbsp;...</kbd>]</p>

<p class="fmtc"><code>env -u ORACLE_SID ORACLE_SID=prod perl make_rpt4.pl</code></p>
<p class="desc">change <samp>ORACLE_SID</samp> and run a perl script;</p>

<p class="cmdc">env</p>
<p class="or">or (probably better)</p>
<p class="cmdc">env | less</p>
<p class="desc">outputs the current env settings (usually it's a long list); you can also use <code>printenv</code> or
<code>set</code>;</p>



<h5>Options</h5>

<p class="fmt"><code>--help</code> &nbsp;&nbsp; <code>--version</code></p>

<p class="fmtc"><code>-i</code>, <code>--ignore-environment</code></p>
<p class="desc">start with an empty environment;</p>

<p class="fmtc"><code>-u</code> <kbd>name</kbd>,
<code>--unset=</code><kbd>name</kbd></p>
<p class="desc">remove variable from the environment;</p>



<h5>About environment variables</h5>
<p>
Remember that [ Linux ] env vars are case-sensitive, and the situation with env vars is a little bit complicated. First of all,
in most cases env vars are uppercase, with words joined by underscore, e.g. <samp>JAVA_HOME</samp>. There are:</p>
<ul>
<li><b>system global</b> (aka <b>system-wide</b>) environment variables;</li>
<li><b>user's global</b> (aka <p>per user</b>) env vars available to all user's processes;</li>
<li><b>user's local</b> (aka <b>shell-specific</b> or <b>per session</b>) env vars available to the current process only; they can
be lowercase (?);</li>
</ul>
<p>
The <samp>/etc/environment</samp> file is used to set up system-wide env vars.</p>
<p>
The <samp>/etc/profile</samp> initializes variables for login shells only.</p>
<p>
The PAM (Linux Pluggable Authentication Modules) module <samp>pam_env</samp> loads the variables to be set in the environment from
the following files in order: <samp>/etc/security/pam_env.conf</samp> and <samp>/etc/environment</samp>. These files are read
before <samp>~/.profile</samp>, <samp>~/.bash_profile</samp>.</p>
<p>
To reference env var, prefix it with <samp>$</samp>, e.g.</p>

<p class="cmd">echo $PATH</p>
<p>
To set a <b>user's global env var</b>, use:</p>

<p class="fmt"><code>export </code><kbd>varname=value</kbd></p>
<p>
To set a <b>user's local env var</b>, use:</p>

<p class="fmtc"><kbd>varname=value</kbd></p>
<p class="or">or</p>
<p class="fmt"><code>set </code><kbd>varname=value</kbd></p>
<p>
To unset a local env var,</p>

<p class="fmtc"><kbd>varname=</kbd></p>
<p class="or">or</p>
<p class="fmt"><code>unset </code><kbd>varname</kbd></p>





<p class="cmdname"><a name="ethtool">ethtool</a></p>
<p>
is a utility allowing to query and configure your NIC (Network Interface Card,
aka <b>Ethernet</b> card, port, device, link, ...). It also provides info about
current state and settings like interface speed, mode, driver, etc.</p>
<p>
Installation in Ubuntu Linux:</p>

<p class="cmdc">sudo apt update</p>
<p class="cmd">sudo apt install ethtool</p>
<p>
The manual is big, but basic cmds are simple. However, some of them (e.g.
setting/changing configuration) require <i>superuser</i> privileges!</p>
<p>
Before you start, find the name(s) of your device(s), e.g.</p>

<p class="cmd">ip a</p>
<p>
Now, assuming that Ethernet NIC's name is, for example, <samp>enp7s0</samp>,
you can get its properties:</p>

<p class="cmd">ethtool enp7s0</p>
<p>
To get info about the currently used driver:</p>

<p class="cmd">ethtool -i enp7s0</p>
<p>
To get network stats (info about network utilization), try following cmd:</p>

<p class="cmd">ethtool -S enp7s0</p>
<p>
(it only works if this feature is supported; see output of the prev cmd).</p>
<p class="center">
<i>Changing NIC settings requires some knowledge and experience, otherwise it
can go wrong!</i></p>
<p>
The following cmd demonstrates how we can switch OFF <b>auto-negotiation</b>
(which is usually ON) and [forcefully] set the desired network <b>speed</b>
(must be supported by both sides of the connection). This trick can be useful
in situations when the other side of the connection does not support
auto-negotiation or network speed is below expectations due to some reasons:</p>

<p class="cmd">sudo ethtool -s enp7s0 speed 1000 autoneg off</p>
<p>
The following feature can be handy if you have several ethernet cards and
do not remember which is what:</p>

<p class="cmd">sudo ethtool -p enp7s0</p>
<p>
It makes LED on the specified interface card to blink.</p>




<p class="cmdname"><a name="expand">expand</a></p>
<p>
converts TABs to spaces in <kbd>file</kbd>, and writes result to stdout.</p>

<p class="fmt"><code>expand&nbsp;</code>[<kbd>options</kbd>] [<kbd>file</kbd>]<kbd>&nbsp;...</kbd></p>
<p>
If <kbd>file</kbd> is missing, or '<code>-</code>' is given, <code>~</code>
gets data from stdin.</p>

<p class="cmdc">expand app.cpp &gt; app2.cpp</p>
<p class="desc">replace all tabs with spaces in <samp>app.cpp</samp> and
save the modified version to <samp>app2.cpp</samp>;</p>


<h5>Options</h5>

<p class="fmt"><code>--help</code> &nbsp;&nbsp; <code>--version</code></p>

<p class="fmtc"><code>-i</code>, <code>--initial</code></p>
<p class="desc">only convert initial TABs, those preceding all non-space
or non-TAB characters;</p>

<p class="fmtc"><code>-t</code> <kbd>n</kbd>[<code>,</code><kbd>m</kbd>]<kbd>...</kbd>,
<code>--tabs=</code><kbd>n</kbd>[<code>,</code><kbd>m</kbd>]<kbd>...</kbd></p>
<p class="desc">if only <kbd>n</kbd> is given, replace each tab with
<kbd>n</kbd> spaces; otherwise replace first tab with <kbd>n</kbd> spaces,
second tab with <kbd>m</kbd> spaces, etc; when the list is over, replace
the remaining tabs with single spaces;</p>
<p>
Omitting <code>-t</code> is equivalent to specifying <code>-t 8</code>;</p>

</div>

</body></html>
